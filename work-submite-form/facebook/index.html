<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Facebook Work Submit Form</title>
  <style>
    :root {
      --bg-color: #ffffff;
      --text-color: #1c1e21;
      --input-bg: #f5f6f7;
      --input-border: #dddfe2;
      --primary-color: #1877f2;
      --shadow-color: rgba(0, 0, 0, 0.12);
      --card-bg: #ffffff;
      --readonly-bg: #f0f2f5;
      --readonly-color: #65676b;
      --readonly-border: #e4e6eb;
    }

    [data-theme="dark"] {
      --bg-color: #18191a;
      --text-color: #e4e6eb;
      --input-bg: #3a3b3c;
      --input-border: #4e4f50;
      --primary-color: #2d88ff;
      --shadow-color: rgba(0, 0, 0, 0.4);
      --card-bg: #242526;
      --readonly-bg: #3a3b3c;
      --readonly-color: #b0b3b8;
      --readonly-border: #4e4f50;
    }

    /* Global Styles */
    body { 
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, var(--bg-color) 0%, var(--input-bg) 100%); 
        display: flex; 
        justify-content: center; 
        align-items: center; 
        min-height: 100vh; 
        margin: 0; 
        height: 100%;
        color: var(--text-color);
        transition: all 0.3s ease;
    }

    .form-container { 
        background: var(--card-bg); 
        padding: 35px; 
        border-radius: 12px; 
        box-shadow: 0 8px 24px var(--shadow-color); 
        width: 90%; 
        max-width: 600px; 
        transition: all 0.3s ease;
    }

    /* Form Header */ 
    .form-container h2 { 
        text-align: center; 
        margin-bottom: 25px; 
        color: var(--primary-color);
        font-size: 24px;
        font-weight: 600;
    }

    /* Form Group */ 
    .form-group { 
        display: flex; 
        justify-content: space-between; 
        margin-bottom: 20px; 
        gap: 12px; 
    }

    .form-item { 
        flex: 1; 
    }

    label { 
        display: block; 
        font-weight: 600; 
        margin-bottom: 8px; 
        color: var(--text-color);
        font-size: 14px;
    }

    select, input { 
        width: 100%; 
        padding: 12px; 
        border: 1px solid var(--input-border); 
        border-radius: 6px; 
        font-size: 14px; 
        box-sizing: border-box; 
        transition: all 0.2s ease; 
        background-color: var(--input-bg);
        color: var(--text-color);
    }

    select:focus, input:focus { 
        border-color: var(--primary-color); 
        outline: none;
        box-shadow: 0 0 0 2px rgba(24, 119, 242, 0.2);
        background-color: var(--card-bg);
    }

    /* Read-only input styling */
    input[readonly] {
        background-color: var(--readonly-bg);
        cursor: not-allowed;
        color: var(--readonly-color);
        border-color: var(--readonly-border);
    }

    /* Single Input */ 
    .form-single { 
        margin-bottom: 20px; 
    }

    button { 
        width: 100%; 
        padding: 14px; 
        background-color: var(--primary-color); 
        color: #ffffff; 
        border: none; 
        border-radius: 6px; 
        font-size: 16px; 
        font-weight: 600;
        cursor: pointer; 
        transition: background-color 0.2s; 
        margin-top: 10px;
    }

    button:hover { 
        background-color: #166fe5; 
    }

    button:disabled { 
        background-color: var(--input-border); 
        cursor: not-allowed; 
        color: var(--readonly-color);
    }

    /* ‚úÖ ‡¶ï‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ ‡¶™‡¶™-‡¶Ü‡¶™ ‡¶∏‡ßç‡¶ü‡¶æ‡¶á‡¶≤ */
    #custom-alert {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        display: none;
        justify-content: center;
        align-items: center;
        z-index: 9999;
    }

    /* üìå ‡¶™‡¶™-‡¶Ü‡¶™ ‡¶¨‡¶ï‡ßç‡¶∏ */
    .alert-box {
        background: var(--card-bg);
        padding: 25px;
        border-radius: 8px;
        text-align: center;
        box-shadow: 0 4px 20px var(--shadow-color);
        min-width: 300px;
        max-width: 90%;
        color: var(--text-color);
    }

    /* üìù ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶∏‡ßç‡¶ü‡¶æ‡¶á‡¶≤ */
    .alert-box p {
        margin: 0 0 20px;
        font-size: 16px;
        line-height: 1.5;
        color: var(--text-color);
    }

    /* üéØ OK ‡¶¨‡¶æ‡¶ü‡¶® */
    #alert-ok {
        width: 100px;
        height: 40px;
        background: var(--primary-color);
        color: white;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-weight: 600;
        transition: background-color 0.2s;
    }

    #alert-ok:hover {
        background: #166fe5;
    }

    /* Go Back */ 
    .styled-wrapper {
      position: fixed;
      bottom: 20px;
      left: 10px;
      z-index: 10;
    }

    .styled-wrapper .button {
      display: block;
      position: relative;
      width: 65px;
      height: 65px;
      margin: 0;
      overflow: hidden;
      outline: none;
      background-color: transparent;
      cursor: pointer;
      border: 0;
    }

    .styled-wrapper .button:before {
      content: "";
      position: absolute;
      border-radius: 20%;
      inset: 7px;
      border: 3px solid var(--text-color);
      transition:
        opacity 0.4s cubic-bezier(0.77, 0, 0.175, 1) 80ms,
        transform 0.5s cubic-bezier(0.455, 0.03, 0.515, 0.955) 80ms;
    }

    .styled-wrapper .button:after {
      content: "";
      position: absolute;
      border-radius: 20%;
      inset: 7px;
      border: 4px solid #599a53;
      transform: scale(1.3);
      transition:
        opacity 0.4s cubic-bezier(0.165, 0.84, 0.44, 1),
        transform 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94);
      opacity: 0;
    }

    .styled-wrapper .button:hover:before,
    .styled-wrapper .button:focus:before {
      opacity: 0;
      transform: scale(0.7);
      transition:
        opacity 0.4s cubic-bezier(0.165, 0.84, 0.44, 1),
        transform 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    }

    .styled-wrapper .button:hover:after,
    .styled-wrapper .button:focus:after {
      opacity: 1;
      transform: scale(1);
      transition:
        opacity 0.4s cubic-bezier(0.77, 0, 0.175, 1) 80ms,
        transform 0.5s cubic-bezier(0.455, 0.03, 0.515, 0.955) 80ms;
    }

    .styled-wrapper .button-box {
      display: flex;
      position: absolute;
      top: 0;
      left: 0;
    }

    .styled-wrapper .button-elem {
      display: block;
      width: 30px;
      height: 30px;
      margin: 18px 18px 0 18px;
      transform: rotate(360deg);
      fill: var(--text-color);
    }

    .styled-wrapper .button:hover .button-box,
    .styled-wrapper .button:focus .button-box {
      transition: 0.4s;
      transform: translateX(-69px);
    }

    /* ‡¶≤‡ßã‡¶°‡¶ø‡¶Ç ‡¶∏‡ßç‡¶™‡¶ø‡¶®‡¶æ‡¶∞ */
    .loader {
      display: none;
      border: 4px solid var(--input-border);
      border-top: 4px solid var(--primary-color);
      border-radius: 50%;
      width: 30px;
      height: 30px;
      animation: spin 1s linear infinite;
      margin: 0 auto;
      margin-top: 15px;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* ‡¶•‡¶ø‡¶Æ ‡¶∏‡ßÅ‡¶á‡¶ö ‡¶¨‡¶æ‡¶ü‡¶® */
    .theme-switch {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 100;
    }

    .theme-switch-wrapper {
      display: flex;
      align-items: center;
    }

    .theme-switch-label {
      margin-right: 10px;
      color: var(--text-color);
      font-weight: 600;
    }

    .theme-switch input {
      display: none;
    }

    .slider {
      position: relative;
      display: inline-block;
      width: 60px;
      height: 34px;
      background-color: #ccc;
      border-radius: 34px;
      transition: .4s;
      cursor: pointer;
    }

    .slider:before {
      position: absolute;
      content: "";
      height: 26px;
      width: 26px;
      left: 4px;
      bottom: 4px;
      background-color: white;
      border-radius: 50%;
      transition: .4s;
    }

    input:checked + .slider {
      background-color: var(--primary-color);
    }

    input:checked + .slider:before {
      transform: translateX(26px);
    }
  </style>
  
  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>
</head>
<body>
  <!-- ‡¶•‡¶ø‡¶Æ ‡¶∏‡ßÅ‡¶á‡¶ö -->
<!--  <div class="theme-switch">
    <div class="theme-switch-wrapper">
      <label class="theme-switch-label" for="checkbox"> 
        <span id="theme-label">‡¶°‡¶æ‡¶∞‡ßç‡¶ï</span> ‡¶Æ‡ßã‡¶°
      </label>
      <input type="checkbox" id="checkbox" />
      <div class="slider"></div>
    </div>
  </div>-->

  <div class="form-container">
    <h2>Facebook Work Submit Form</h2>
    
    <!-- First Set -->
    <div class="form-group">
      <div class="form-item">
        <label for="account-type">Account Type:</label>
        <select id="account-type" required>
          <option disabled>--Select-- </option>
          <option selected>Facebook</option>
        </select>
      </div>
      <div class="form-item">
        <label for="mail-box">Mail Type:</label>
        <select id="mail-box" required>
          <option disabled selected>Select</option>
          <option > Web Mail </option>
          <option > Trusted Hotmail </option>
          <option > Trusted Outlook </option>
          <option>Temp Mail</option>
          <option selected>Any Mail</option>
          <option > Sort Mail </option>
        </select>
      </div>
    </div>

    <!-- Second Set -->
    <div class="form-group">
      <div class="form-item">
        <label for="2fa-cookie">2FA-Cook</label>
        <select id="2fa-cookie">
          <option disabled selected>--Select--</option>
          <option value="2FA">2FA</option>
          <option value="Cookies">Cookies</option>
        </select>
      </div>
      <div class="form-item">
        <label for="fd-type">Friends:</label>
        <select id="fd-type">
          <option disabled selected>--Select--</option>
          <option value="0FD">0FD</option>
          <option value="10FD">10FD</option>
          <option value="20FD">20FD</option>
          <option value="30FD">30FD</option>
        </select>
      </div>
      <div class="form-item">
        <label for="ttl-id">Total Id:</label>
        <input type="text" id="ttl-id" placeholder="Total Id" maxlength="4">
      </div>
    </div>

    <!-- Third Set -->
    <div class="form-group">
      <div class="form-item">
        <label for="tg-username">UserName:</label>
        <input type="text" id="tg-username" placeholder="Username" readonly>
      </div>
      <div class="form-item">
        <label for="tg-chat-id">User ID:</label>
        <input type="text" id="tg-chat-id" placeholder="User ID" maxlength="10" readonly>
      </div>
    </div>

    <!-- Single Input -->
    <div class="form-single">
      <label for="google-sheet">File Link:</label>
      <input type="url" id="google-sheet" placeholder="Paste File Link Here">
    </div>

    <button type="submit" id="submit-btn">Submit</button>
    <div class="loader" id="loader"></div>
  </div>
  
  <!-- ‚úÖ ‡¶ï‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ ‡¶™‡¶™-‡¶Ü‡¶™ -->
  <div id="custom-alert" class="hidden">
      <div class="alert-box">
          <p id="alert-message"></p>
          <button id="alert-ok">OK</button>
      </div>
  </div>

  <!-- Go Back --> 
  <div class="styled-wrapper">
    <button onclick="goBack()" class="button">
      <div class="button-box">
        <span class="button-elem">
          <svg
            viewBox="0 0 24 24"
            xmlns="http://www.w3.org/2000/svg"
            class="arrow-icon"
          >
            <path
              d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"
            ></path>
          </svg>
        </span>
        <span class="button-elem">
          <svg
            viewBox="0 0  24 24"
            xmlns="http://www.w3.org/2000/svg"
            class="arrow-icon"
          >
            <path
              d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"
            ></path>
          </svg>
        </span>
      </div>
    </button>
  </div>

  <script>
    // Firebase configuration - replace with your actual config
    const firebaseConfig = {
      apiKey: "AIzaSyCs6ePkTxvMjcERh6yAdvjPqxIu6X7jhRM",
      authDomain: "fbm-market-bot.firebaseapp.com",
      projectId: "fbm-market-bot",
      storageBucket: "fbm-market-bot.firebasestorage.app",
      messagingSenderId: "711610016805",
      appId: "1:711610016805:web:c5a019c9af1485ac984bcc"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);

    // ‡¶•‡¶ø‡¶Æ ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶Æ‡ßá‡¶®‡ßç‡¶ü
    function setupTheme() {
      const checkbox = document.getElementById('checkbox');
      const themeLabel = document.getElementById('theme-label');
      const prefersDarkScheme = window.matchMedia('(prefers-color-scheme: dark)');
      
      // localStorage ‡¶•‡ßá‡¶ï‡ßá ‡¶•‡¶ø‡¶Æ ‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç ‡¶™‡¶°‡¶º‡ßÅ‡¶®
      const currentTheme = localStorage.getItem('theme');
      
      if (currentTheme === 'dark' || (!currentTheme && prefersDarkScheme.matches)) {
        document.documentElement.setAttribute('data-theme', 'dark');
        checkbox.checked = true;
        themeLabel.textContent = '‡¶≤‡¶æ‡¶á‡¶ü';
      } else {
        document.documentElement.setAttribute('data-theme', 'light');
        checkbox.checked = false;
        themeLabel.textContent = '‡¶°‡¶æ‡¶∞‡ßç‡¶ï';
      }
      
      // ‡¶•‡¶ø‡¶Æ ‡¶∏‡ßÅ‡¶á‡¶ö ‡¶á‡¶≠‡ßá‡¶®‡ßç‡¶ü ‡¶≤‡¶ø‡¶∏‡ßá‡¶®‡¶æ‡¶∞
      checkbox.addEventListener('change', function() {
        if (this.checked) {
          document.documentElement.setAttribute('data-theme', 'dark');
          localStorage.setItem('theme', 'dark');
          themeLabel.textContent = '‡¶≤‡¶æ‡¶á‡¶ü';
        } else {
          document.documentElement.setAttribute('data-theme', 'light');
          localStorage.setItem('theme', 'light');
          themeLabel.textContent = '‡¶°‡¶æ‡¶∞‡ßç‡¶ï';
        }
      });
    }

    // URL ‡¶•‡ßá‡¶ï‡ßá ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶°‡ßá‡¶ü‡¶æ ‡¶™‡¶°‡¶º‡¶æ‡¶∞ ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®
    function getUserFromURL() {
      const urlParams = new URLSearchParams(window.location.search);
      const userStr = urlParams.get("user");
      
      if (!userStr) {
        console.log("No user data found in URL");
        return null;
      }
      
      try {
        // URL decode ‡¶è‡¶¨‡¶Ç JSON parse ‡¶ï‡¶∞‡ßÅ‡¶®
        return JSON.parse(decodeURIComponent(userStr));
      } catch (error) {
        console.error("Error parsing user data:", error);
        return null;
      }
    }

    // Firebase-‡¶è ‡¶°‡ßá‡¶ü‡¶æ ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®
    function saveToFirebase(formData) {
      const database = firebase.database();
      const newSubmissionRef = database.ref('submissions').push();
      return newSubmissionRef.set(formData);
    }

    // DOM ‡¶≤‡ßã‡¶° ‡¶π‡¶≤‡ßá ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶°‡ßá‡¶ü‡¶æ ‡¶Ö‡¶ü‡ßã-‡¶´‡¶ø‡¶≤ ‡¶ï‡¶∞‡ßÅ‡¶®
    document.addEventListener('DOMContentLoaded', function() {
      // ‡¶•‡¶ø‡¶Æ ‡¶∏‡ßá‡¶ü‡¶Ü‡¶™
      setupTheme();
      
      const user = getUserFromURL();
      
      if (user) {
        // username ‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®
        document.getElementById('tg-username').value = user.username ? '@' + user.username : '';
        
        // user ID (chat ID) ‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®
        document.getElementById('tg-chat-id').value = user.id || '';
        
        // ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶°‡ßá‡¶ü‡¶æ ‡¶ó‡ßç‡¶≤‡ßã‡¶¨‡¶æ‡¶≤ ‡¶≠‡ßá‡¶∞‡¶ø‡¶Ø‡¶º‡ßá‡¶¨‡¶≤‡ßá ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡ßÅ‡¶®
        window.userData = user;
      } else {
        // Fallback ‡¶Ø‡¶¶‡¶ø user data ‡¶®‡¶æ ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º
        document.getElementById('tg-username').value = '@username';
        document.getElementById('tg-chat-id').value = '';
      }
    });

    // ‡¶ï‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ ‡¶è‡¶≤‡¶æ‡¶∞‡ßç‡¶ü ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®
    function showAlert(message) {
      const alertBox = document.getElementById("custom-alert");
      const alertMessage = document.getElementById("alert-message");
      
      alertMessage.textContent = message;
      alertBox.style.display = "flex";
    }

    document.getElementById("alert-ok").addEventListener("click", function () {
      document.getElementById("custom-alert").style.display = "none";
    });

    // ‡¶ó‡ßã ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®
    function goBack() {
      window.history.back();
    }

    // ‡¶≤‡ßã‡¶°‡¶ø‡¶Ç ‡¶∏‡ßç‡¶ü‡ßá‡¶ü ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶Æ‡ßá‡¶®‡ßç‡¶ü
    function setLoadingState(isLoading) {
      const submitBtn = document.getElementById("submit-btn");
      const loader = document.getElementById("loader");
      
      if (isLoading) {
        submitBtn.disabled = true;
        submitBtn.textContent = "Submitting...";
        loader.style.display = "block";
      } else {
        submitBtn.disabled = false;
        submitBtn.textContent = "Submit";
        loader.style.display = "none";
      }
    }

    // ‡¶´‡¶∞‡ßç‡¶Æ ‡¶≠‡ßç‡¶Ø‡¶æ‡¶≤‡¶ø‡¶°‡ßá‡¶∂‡¶® ‡¶è‡¶¨‡¶Ç ‡¶∏‡¶æ‡¶¨‡¶Æ‡¶ø‡¶∂‡¶®
    document.getElementById("account-type").addEventListener("change", function () { 
      const accountType = this.value.toLowerCase(); 
      const mailBox = document.getElementById("mail-box"); 
      const cookie2fa = document.getElementById("2fa-cookie"); 
      const fdType = document.getElementById("fd-type");

      mailBox.disabled = false;
      mailBox.required = true;
      cookie2fa.disabled = false;
      cookie2fa.required = true;
      fdType.disabled = false;
      fdType.required = true;

      if (cookie2fa.value === "Cookies") {
          fdType.disabled = true;
          fdType.value = "";
      } else {
          fdType.disabled = false;
      }
    });

    document.getElementById("2fa-cookie").addEventListener("change", function () { 
      const fdType = document.getElementById("fd-type"); 
      if (this.value === "Cookies") { 
          fdType.disabled = true; 
          fdType.value = ""; 
      } else { 
          fdType.disabled = false; 
      }
    });

    document.getElementById("submit-btn").addEventListener("click", async function () { 
      const accountType = document.getElementById("account-type").value; 
      const mailBox = document.getElementById("mail-box").value || " "; 
      const cookie2fa = document.getElementById("2fa-cookie").value;
      const fdType = document.getElementById("fd-type").value || " "; 
      const ttlId = document.getElementById("ttl-id").value; 
      const tgUsername = document.getElementById("tg-username").value.trim();
      const tgChatId = document.getElementById("tg-chat-id").value; 
      const googleSheet = document.getElementById("google-sheet").value;

      // 2FA-Cook ‡¶≠‡ßç‡¶Ø‡¶æ‡¶≤‡¶ø‡¶°‡ßá‡¶∂‡¶® ‡¶†‡¶ø‡¶ï ‡¶ï‡¶∞‡¶æ
      if (!cookie2fa || cookie2fa === "--Select--") {
        showAlert("‡¶¶‡¶Ø‡¶º‡¶æ ‡¶ï‡¶∞‡ßá 2FA/Cookies ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®‡•§");
        return;
      }

      // ‡¶∂‡ßÅ‡¶ß‡ßÅ‡¶Æ‡¶æ‡¶§‡ßç‡¶∞ @ ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡¶æ
      if (!tgUsername.startsWith("@")) {
          showAlert(" ‡¶Ö‡¶¨‡¶∂‡ßç‡¶Ø‡¶á ‡¶™‡ßç‡¶∞‡¶•‡¶Æ‡ßá '@' ‡¶¶‡¶ø‡¶§‡ßá ‡¶π‡¶¨‡ßá‡•§ ");
          return;
      }

      const requiredFields = [
          { value: accountType, name: "Account Type" },
          { value: cookie2fa, name: "2FA/Cookies" },
          { value: ttlId, name: "Ttl Id" },
          { value: tgUsername, name: "Tg Username" },
          { value: tgChatId, name: "Tg Chat Id" },
          { value: googleSheet, name: "Google Sheet Link" }
      ];

      for (const field of requiredFields) {
          if (!field.value || field.value === "Select" || field.value === "--Select--") {
              showAlert(`‡¶¶‡¶Ø‡¶º‡¶æ ‡¶ï‡¶∞‡ßá ${field.name} ‡¶™‡ßÇ‡¶∞‡¶£ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§`);
              return;
          }
      }

      if (!/^\d{1,4}$/.test(ttlId)) {
          showAlert("Ttl Id must be between 1 and 4 digits.");
          return;
      }

      if (!/^\d{9,10}$/.test(tgChatId)) {
          showAlert("Tg Chat Id must be 9 or 10 digits.");
          return;
      }

      const sheetLinkRegex = /^https?:\/\/(docs\.google\.com\/spreadsheets\/.+)/;
      if (!sheetLinkRegex.test(googleSheet)) {
          showAlert("Please enter a valid Google Sheet link.");
          return;
      }

      let chatIdForBot;

      if (cookie2fa === "Cookies") {
          chatIdForBot = "-1002372301785";
      } else if (cookie2fa === "2FA" &&  fdType === "30FD") {
          chatIdForBot = "-1002635815704";
      } else if (cookie2fa === "2FA" &&  fdType === "0FD") {
          chatIdForBot = "-1002636197141";
      } else if (cookie2fa === "2FA" &&  fdType === "10FD") {
          chatIdForBot = "-1002654345940";
      } else {
          showAlert("‡¶∏‡¶†‡¶ø‡¶ï‡¶≠‡¶æ‡¶¨‡ßá 2FA ‡¶¨‡¶æ Cookies ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®‡•§");
          return;
      }

      const options = { 
          timeZone: "Asia/Dhaka", 
          day: "2-digit", 
          month: "2-digit", 
          year: "numeric",
          hour: "2-digit", 
          minute: "2-digit", 
          second: "2-digit",
          hour12: true 
      };
      const currentDate = new Date().toLocaleString("en-GB", options).replace(",", "");

      // ‡¶Ü‡¶™‡¶°‡ßá‡¶ü‡ßá‡¶° ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶´‡¶∞‡¶Æ‡ßç‡¶Ø‡¶æ‡¶ü
      const message = `
‚úÖ ‡¶®‡¶§‡ßÅ‡¶® ‡¶´‡¶∞‡ßç‡¶Æ ‡¶∏‡¶æ‡¶¨‡¶Æ‡¶ø‡¶∂‡¶®

üìã ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶¨‡¶ø‡¶¨‡¶∞‡¶£:
‚Ä¢ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶ü‡¶æ‡¶á‡¶™: ${accountType}
‚Ä¢ ‡¶Æ‡ßá‡¶á‡¶≤ ‡¶¨‡¶ï‡ßç‡¶∏: ${mailBox}
‚Ä¢ 2FA/‡¶ï‡ßÅ‡¶ï‡¶ø‡¶ú: ${cookie2fa}
‚Ä¢ ‡¶¨‡¶®‡ßç‡¶ß‡ßÅ ‡¶ü‡¶æ‡¶á‡¶™: ${fdType}

üë§ ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞‡¶ï‡¶æ‡¶∞‡ßÄ‡¶∞ ‡¶§‡¶•‡ßç‡¶Ø:
‚Ä¢ ‡¶ü‡ßá‡¶≤‡¶ø‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ ‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡¶®‡ßá‡¶Æ: ${tgUsername}
‚Ä¢ ‡¶ü‡ßá‡¶≤‡¶ø‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ ‡¶ö‡ßç‡¶Ø‡¶æ‡¶ü ‡¶Ü‡¶á‡¶°‡¶ø: ${tgChatId}
‚Ä¢ ‡¶Æ‡ßã‡¶ü ‡¶Ü‡¶á‡¶°‡¶ø: ${ttlId}

üìé ‡¶´‡¶æ‡¶á‡¶≤ ‡¶≤‡¶ø‡¶Ç‡¶ï: ${googleSheet}

üïê ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ ‡¶ì ‡¶∏‡¶Æ‡¶Ø‡¶º: ${currentDate}
      `;

      const botToken = "7734169736:AAGDFW2mVkNSLrrPClDohEfNE0whlwmBiuE";
      const telegramUrl = `https://api.telegram.org/bot${botToken}/sendMessage?chat_id=${chatIdForBot}&text=${encodeURIComponent(message)}`;

      // ‡¶≤‡ßã‡¶°‡¶ø‡¶Ç ‡¶∏‡ßç‡¶ü‡ßá‡¶ü ‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®
      setLoadingState(true);

      try {
        // 1. ‡¶™‡ßç‡¶∞‡¶•‡¶Æ‡ßá Telegram ‡¶¨‡¶ü‡ßá ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶™‡¶æ‡¶†‡¶æ‡¶®
        const response = await fetch(telegramUrl);
        const result = await response.json();
        
        if (response.status >= 200 && response.status < 300) {
          // 2. Telegram ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶∏‡¶´‡¶≤ ‡¶π‡¶≤‡ßá Firebase-‡¶è ‡¶°‡ßá‡¶ü‡¶æ ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡ßÅ‡¶®
          const formData = {
            accountType: accountType,
            mailBox: mailBox,
            cookie2fa: cookie2fa,
            fdType: fdType,
            ttlId: ttlId,
            tgUsername: tgUsername,
            tgChatId: tgChatId,
            googleSheet: googleSheet,
            submissionTime: currentDate,
            timestamp: new Date().getTime(),
            telegramUserId: window.userData?.id || '',
            telegramUsername: window.userData?.username || ''
          };

          await saveToFirebase(formData);
          console.log("Data saved to Firebase successfully");

          // 3. ‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡¶ï‡ßá confirmation ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶™‡¶æ‡¶†‡¶æ‡¶®
          await sendReadyMadeMessageToUser(tgChatId);
          
          // 4. ‡¶∏‡¶æ‡¶ï‡¶∏‡ßá‡¶∏ ‡¶™‡ßá‡¶ú‡ßá ‡¶∞‡¶ø‡¶°‡¶æ‡¶á‡¶∞‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®
          let redirectPage = "success.html"; // ‡¶°‡¶ø‡¶´‡¶≤‡ßç‡¶ü
          
          if (cookie2fa === "Cookies") {
            redirectPage = "success/fb-success-cookies.html";
          } else if (cookie2fa === "2FA" && fdType === "30FD") {
            redirectPage = "success/fb-success-30fd.html";
          } else if (cookie2fa === "2FA" && fdType === "0FD") {
            redirectPage = "success/fb-success-0fd.html";
          } else if (cookie2fa === "2FA" && fdType === "10FD") {
            redirectPage = "success/fb-success-10fd.html";
          }

          const successData = {
            profilePicture: window.userData?.photo_url || "",
            userName: (window.userData?.first_name || "") + " " + (window.userData?.last_name || ""),
            userUsername: window.userData?.username ? '@' + window.userData.username : '',
            chatId: window.userData?.id || tgChatId
          };

          const encodedData = encodeURIComponent(JSON.stringify(successData));
          
          setTimeout(() => {
            window.location.href = `${redirectPage}?data=${encodedData}`;
          }, 1000);
        } else {
          console.error("API Error:", result);
          showAlert(`Failed: ${result.description}`);
          setLoadingState(false);
        }
      } catch (error) {
        console.error("Network Error:", error);
        showAlert("Failed to send data. Please check your network and try again.");
        setLoadingState(false);
      }
    });

    async function sendReadyMadeMessageToUser(tgChatId) {
      const botToken = "7673657711:AAG9aHlpI8_Egvwi0fY9rxA4qyEfqOw16nU";

      const today = new Date().toLocaleString("en-GB", {
        timeZone: "Asia/Dhaka",
        day: "2-digit",
        month: "2-digit",
        year: "numeric",
        hour: "2-digit",
        minute: "2-digit",
        second: "2-digit",
        hour12: true
      });

      const mediaUrl = "https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEj7TresD68j1z7kGLxwCZwyxX9D2tg_iC5tuUQOnbPpOwTNcRICz91oFLCLP3bzBhIzXKt7sGDSAZC5HvpKvcFjaHhefNIndTl6uGgw7BUh5aN8XD1d2YJs0wol1tfWDIidivg4Fjls0vKLJF-91rPLrEYdJ7v_ZN3VHg2_Y8FQ12a1el9232IgTimTZD0V/s1280/wssfl.png";

      const caption = `Submit Successful üíê \n\n‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶ï‡¶æ‡¶ú ‡¶∏‡¶´‡¶≤ ‡¶≠‡¶æ‡¶¨‡ßá ‡¶ú‡¶Æ‡¶æ ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§ \n\n‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶ï‡¶æ‡¶ú‡ßá‡¶∞ ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶ú‡¶æ‡¶®‡¶§‡ßá ‡¶Ö‡¶¨‡¶∂‡ßç‡¶Ø‡¶á ‡¶Ü‡¶Æ‡¶æ‡¶¶‡ßá‡¶∞ ‡¶ó‡ßç‡¶∞‡ßÇ‡¶™‡ßá ‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§ ‡¶•‡¶æ‡¶ï‡ßÅ‡¶® ‡¶è‡¶¨‡¶Ç ‡¶Ø‡ßá‡¶ï‡ßã‡¶®‡ßã ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ‡¶∞ ‡¶∏‡¶Æ‡¶æ‡¶ß‡¶æ‡¶® ‡¶®‡¶ø‡¶®‡•§   \n\n‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ: ${today}`;

      const replyMarkup = {
        inline_keyboard: [[
          {
            text: "Join Group",
            url: "https://t.me/fbmMarket"
          }
        ]]
      };

      const apiUrl = `https://api.telegram.org/bot${botToken}/sendPhoto`;

      const formData = {
        chat_id: tgChatId,
        photo: mediaUrl,
        caption: caption,
        reply_markup: JSON.stringify(replyMarkup),
        parse_mode: "HTML"
      };

      try {
        const response = await fetch(apiUrl, {
          method: "POST",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify(formData)
        });
        
        const data = await response.json();
        if (!data.ok) {
          console.error("Failed to send media message:", data);
        }
      } catch (err) {
        console.error("Error sending media message:", err);
      }
    }
  </script>
</body>
  </html>
